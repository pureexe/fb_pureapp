<!-- GPLv3 @2014 - Pakkapon Phongthawee -->
<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <title>ใครไลค์ฉันมากสุด : pure's app</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
    <script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
	<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-54361036-1', 'auto');
  ga('send', 'pageview');

</script>
    <style>
        body { padding-top: 70px;
                padding-bottom: 70px;
        }
    </style>
</head>
<body>
<div id="fb-root"></div>
    <script>
        /// Utility Function
        $._GET = function(name, url) {
            if (!url) {
                url = window.location.href;
            }
            var results = new RegExp('[\\?&]' + name + '=([^&#]*)').exec(url);
            if (!results) { 
                return 0; 
            }
            return results[1] || 0;
        }
        
        $._DateDiff = function datediff(strDate1, strDat2) {
            if (!strDat2) {
                return (Date.now()/1000-Date.parse(strDate1)/1000)/(60*60*24);
            } else {
                return (Date.parse(strDate2)/1000-Date.parse(strDate1)/1000)/(60*60*24);
            }
        }                
        // Global Variable
        var hash_name=[];
		var tab_name=[];
		var threadlist;
		var cnt_thread=0;
        // Facebook Connector         
        window.fbAsyncInit = function() {
            FB.init({
                appId   : '351070565012663', // pure's app id
                xfbml      : true,
                  version    : 'v2.0'
            });
            FB.getLoginStatus(function(response) {
                if (response.status === 'connected') {
					$("#app-display").show();
					$("#login-display").hide();
					$("#right_post").hide();
					$("#right_ok").hide();
//						console.log(JSON.stringify(re));
 //                       $('#chat_table tr:eq(1)').remove();
                     
					 var mergetable = function(){
						console.log("All load = "+tab_name.length);
						console.log(JSON.stringify(tab_name));
					 }
					 
					 var threadexplore = function() {
						FB.api('/'+threadlist[cnt_thread].thread_id+'?fields=to',function(re) {
							var tab_name_bf=[];
							var res =re.to.data;
							res.forEach(function (a){
								if(threadlist[cnt_thread].viewer_id!=a){
									tab_name_bf.push(a);
								}
							})
							tab_name.push(tab_name_bf);
							
							if(cnt_thread<threadlist.length-1){
								console.log("LOAD : "+(cnt_thread+1) + " / "+ threadlist.length);
								cnt_thread++;
								threadexplore();
							}else {
								mergetable();
							}
						})
					 }
					 
                    var re = FB.api({
						method: 'fql.query',
						query: 'SELECT thread_id,viewer_id,recipients,message_count FROM thread WHERE folder_id = 0 ORDER BY message_count DESC'
					},function (re){
						threadlist=re;
						threadexplore();
					});
                } else{
					console.log("Not logged in");
					$("#app-display").hide();
					$("#login-display").show();
				}
            })
        };

    (function(d, s, id){
        var js, fjs = d.getElementsByTagName(s)[0];
        if (d.getElementById(id)) {return;}
        js = d.createElement(s); js.id = id;
        js.src = "//connect.facebook.net/th_TH/sdk.js";
        fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));
    var gotop = function(){
        $(function() {
		$('body,html').stop(true,true).animate({scrollTop: 0}, 1000);
        });
    }
    var postfacebook = function() {
		$("#right_post").hide();
		$("#right_load").show();
            var txt_postmsglength = 0;
            if(result_likes.length>=5){
                txt_postmsglength= 5;
            } else {
                txt_postmsglength= result_likes.length;
            }
            var i;
            var txt_postmsg = 'ใน '+time_ago+'ที่ผ่านมาฉันโพส '+thread.length+' โพส\nเพื่อนที่เข้ามาไลค์มากที่สุดดังนี้';;
            for(i=0;i<txt_postmsglength;i++){
                txt_postmsg+='\nอันดับ '+(i+1)+' ได้แก่ '+result_likes[i].name+' ไลค์ '+result_likes[i].count+' ครั้ง ';
            }
            txt_postmsg+='\nอยากรู้อันดับเพื่อนที่เข้ามาไลค์คุณ เข้ามาที่ https://www.facebook.com/appmadebypure #pureapp';
            FB.api('/me/feed', 'post', { message: txt_postmsg},function(res) {
	
					$("#right_load").hide();
					$("#right_ok").show();
        	});

    }
	var logintofacebook = function(){
		FB.login(function(){
			window.location.reload();
		},{scope: 'publish_actions,publish_stream,read_mailbox'})
	}

</script>
<nav class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="#">ใครไลค์ฉันมากสุด</a>
    </div>
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav navbar-right">
        <li><a href="https://www.facebook.com/appmadebypure">หน้าแรก</a></li>
        <li><a href="https://www.facebook.com/appmadebypure">แฟนเพจ</a></li>
        <li><a><div class="fb-like" data-href="https://purelink.koding.io/toplike_thismonth" data-layout="button_count" data-action="like" data-show-faces="true" data-share="true"></div></a></li>
      </ul>
    </div><!-- /.navbar-collapse -->
  </div><!-- /.container-fluid -->
</nav>
<div class="container" id="login-display" style="display: none;">
<div class="jumbotron">
  <h1>อีกขั้นเดียว!</h1>
  <p>เนื่องจากแอปพลิเคชันของเราต้องการเข้าถึงสิทธิในการใช้ข้อมูลส่วนตัวของคุณโดยพวกเราจะใช้สิทธิต่างๆดังนี้
  <ul>
	<li>โพสข้อความของคุณ - ทุกแอปพลิเคชันของเราต้องการสิทธิในการโพสไปยังเฟสบุ๊คของคุณเพื่อให้สามารถใช้การปุ่มโพสไปยังเฟสบุ๊คได้</li>
	<li>เข้าถึงฟีดข่าวของคุณ - แอปคนที่ไลค์คุณมากสุดและคนที่คอมเม้นฉันมากสุดต้องการเข้าถึงฟีดข่าวของคุณเพื่อนับจำนวนคอมเม้นและไลค์</li>
	<li>เข้าถึงข้อความของคุณ - แอปใครไลค์ฉันมากสุดต้องการเข้าถึงข้อความของคุณเพื่อนับจำนวนแชทของคุณ</li>
 </ul>
 โดยทางเราขอให้คำมันสัญญาว่าทางเราจะไม่เก็บหรืออ่านข้อมูลส่วนตัวของผู้ใช้บริการเด็ดขาด
  </p>
  <p>ขอแสดงความนับถือ - เพียว (ผู้สร้างแอป) </p>
	  <p><button onclick="logintofacebook()" class="btn btn-primary" id="postfacebtn"><span id="postface_txt">ลงชื่อเข้าใช้ด้วยเฟสบุ๊ค</span></button></p>
</div>
</div>

<div class="container" id="app-display" style="display: none;">


 <div  id="right_post" style="display: none;">
        <button onclick="postfacebook()" class="btn btn-primary" id="postfacebtn"><span id="postface_txt">โพสบนเฟสบุ๊ค</span></button>
</div>
 <div  id="right_load" style="display: none;">
        <button class="btn btn-warning" ><span id=>กำลังโหลด</span></button>
</div>
 <div  id="right_ok" style="display: none;">
        <button class="btn btn-success" ><span id=>โพสเรียบร้อย</span></button>
</div>    
	
    <table class="table table-hover" id="chat_table">
        <thead><tr><th class="">#</th><th class="hidden-xs">รูป</th><th class="">ชื่อ</th><th class="">แชท</th></tr></thead>
        <tr><td colspan="4"><center><img alt="" src="data:image/gif;base64,R0lGODlhEAALAPQAAP///0Ve3uPn+dzh+O/x+0lh3kVe3mZ646Ov7oqa6szT9V1z4nqM56m0742c6s/V9WB14kdg3n2P5+zu+uLm+fb3/G2B5eXo+fX2/MnQ9LnC8tjd9/Lz+wAAAAAAAAAAACH+GkNyZWF0ZWQgd2l0aCBhamF4bG9hZC5pbmZvACH5BAALAAAAIf8LTkVUU0NBUEUyLjADAQAAACwAAAAAEAALAAAFLSAgjmRpnqSgCuLKAq5AEIM4zDVw03ve27ifDgfkEYe04kDIDC5zrtYKRa2WQgAh+QQACwABACwAAAAAEAALAAAFJGBhGAVgnqhpHIeRvsDawqns0qeN5+y967tYLyicBYE7EYkYAgAh+QQACwACACwAAAAAEAALAAAFNiAgjothLOOIJAkiGgxjpGKiKMkbz7SN6zIawJcDwIK9W/HISxGBzdHTuBNOmcJVCyoUlk7CEAAh+QQACwADACwAAAAAEAALAAAFNSAgjqQIRRFUAo3jNGIkSdHqPI8Tz3V55zuaDacDyIQ+YrBH+hWPzJFzOQQaeavWi7oqnVIhACH5BAALAAQALAAAAAAQAAsAAAUyICCOZGme1rJY5kRRk7hI0mJSVUXJtF3iOl7tltsBZsNfUegjAY3I5sgFY55KqdX1GgIAIfkEAAsABQAsAAAAABAACwAABTcgII5kaZ4kcV2EqLJipmnZhWGXaOOitm2aXQ4g7P2Ct2ER4AMul00kj5g0Al8tADY2y6C+4FIIACH5BAALAAYALAAAAAAQAAsAAAUvICCOZGme5ERRk6iy7qpyHCVStA3gNa/7txxwlwv2isSacYUc+l4tADQGQ1mvpBAAIfkEAAsABwAsAAAAABAACwAABS8gII5kaZ7kRFGTqLLuqnIcJVK0DeA1r/u3HHCXC/aKxJpxhRz6Xi0ANAZDWa+kEAA7AAAAAAAAAAAA" /></center></td><tr>
    </table>
</div>

<nav class="navbar navbar-default navbar-fixed-bottom" role="navigation" style="height: 50px;">
  <div class="container">
 <div class="">
    <ul class="nav navbar-nav">
     <li><a class="" href="#">พื้นที่ว่างสำหรับติดโฆษณา</a></li>
     </ul>
    </div>
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav navbar-right">
        <li><a href="https://www.facebook.com/appmadebypure">since 2014 : pure's app</a></li>
        <li><a href="javascript:gotop()">กลับไปบนสุด</a></li>
      </ul>
    </div> 
  </div>
</nav>
</body>
</html>
