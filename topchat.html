<!-- GPLv3 @2014 - Pakkapon Phongthawee -->
<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <title>ใครคุยกับฉันมากสุด : pure's app</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
    <script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
	<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-54361036-1', 'auto');
  ga('send', 'pageview');

</script>
    <style>
        body { padding-top: 70px;
                padding-bottom: 70px;
        }
    </style>
</head>
<body>
<div id="fb-root"></div>
    <script>
        /// Utility Function
        $._GET = function(name, url) {
            if (!url) {
                url = window.location.href;
            }
            var results = new RegExp('[\\?&]' + name + '=([^&#]*)').exec(url);
            if (!results) { 
                return 0; 
            }
            return results[1] || 0;
        }
        
        $._DateDiff = function datediff(strDate1, strDat2) {
            if (!strDat2) {
                return (Date.now()/1000-Date.parse(strDate1)/1000)/(60*60*24);
            } else {
                return (Date.parse(strDate2)/1000-Date.parse(strDate1)/1000)/(60*60*24);
            }
        }                
        // Global Variable
        var hash_name=[];
		var tab_name=[];
		var threadlist;
		var cnt_thread=0;
        // Facebook Connector         
        window.fbAsyncInit = function() {
            FB.init({
                appId   : '351070565012663', // pure's app id
                xfbml      : true,
                  version    : 'v2.0'
            });
            FB.getLoginStatus(function(response) {
                if (response.status === 'connected') {
					$("#app-display").show();
					$("#login-display").hide();
					$("#right_ok").hide();
					$("#right_load").show();
					$("#right_post").hide();
//						console.log(JSON.stringify(re));
 //                       $('#chat_table tr:eq(1)').remove();
                     
					 var mergetable = function(){
						var mergetxt="";
						var cnt=1;
						tab_name.forEach(function (a){
							if(a.length == 0){
								mergetxt+="<tr><td>"+cnt+"</td><td><img alt='' src='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAJOgAACToB8GSSSgAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAUSSURBVHic7ZtLbFZFFMd/Y8ujKzWiCwlRUAOYKFppNQakRBcKikHxmWCiiSaNkhhEYaVxR9SkQnQhJsZoRNjVKAvjBtREWJVYFxhflZIiiSixVgRrj4uZTy/TmfvNvXfuI7EnOYt+35zH/3/PzJ3vzFSJCP9n6awiiFJqNrAUWAZ0AcPAsIiMVxE/TVQZFaCUmgM8AvQB1wJLmE62AD8AXwKHgDdF5GT0ZNqJiERTQAFPAmMGYBYdB7YDc2Pm1DbniOAvAD7IAdzWIeCKqgiIMgVMyR8AbizsTMsY0CMiY5H8eeW8SH7eIB54gEuBQbN4lisRSr+X4mXv0ycaPwWUUh8Baws58csIcJWITJbkvxgBSqlZwB+Uu5+4XkQOl+W86BpwJeVvppaW6bwoAaUmV0WMogQsiZJFjTFmKqCg/YVRsqgxRlECjkbJosYYRQn4MUoWNcaYIaCg/UiMJOqMMVMBBe1/As7ESCRFmkuA6B8SZa7SQpMJMPJJBB8+OSgiEyX6j0LA7gg+fLK3RN9AhK6wUkqhu7uXRcnoP5kCFpTdFitcAWYdeDlCLrbsrqInGKsp2gl8BSwu7EzLaWCxiIxG8ueVKE1R07J6Gr1qx5DtVYAHoh+MbKF4I/R9TGVWofEdwksFwO8DZlcFvhQCDAl3oneJocBPo6dQZU++paUcjgIopa4GbgU2Aj2eYd8C7wEfi8gXln0Hut3eDRwD9onI8cDYXcB6dDdpBBgU38FrSRWwFf0b4T7z9zz00fgdwDpgOTDffNcN/AK8jSl/9J7iIOdWySngwYDYy4CvLdsTwO2lTwFgFvBWIvBfwP0p428w4FvjPzXkjOCeKlPAYyn+ui1/ST0DrCuNAOAm4DNH4EngAcf45cCvnmTT1ElCG/BeEoqCVqakXcBtEh5K2PVkAL8HfXfAS0IK+HeAs2kk5AU+B3gcOJLhyU0CD6MPU08F2gyYeCt9JKSA32Zs7/aQsCYzAcBs9AKX5RVnk2ADSQWfiL0S+N1Bwm8+8Anb9Q4SfgYuyQJ+QcYnXkQHPDnc4iAhFXzC9h70opwcuzkUfBdwuCLwQ6RsiIBVKSQ4wSdsB6zxu0IJeLEi8KkVkMinD5jICH5DrgoAFqG3qlUSkJWEPODD1gDgwxrAh5KwGtiSA3zYWwC4q0bwQSTkBN9+HwDMBb5vAAG5SAgB346AFxoAPBcJoeC9BAALqWfhK0wCcK8D/FkXeBHx9gR3oKdA0yTkFOoE8Kf1WScw3znaweBa6n/SLt2cYQr4ts39qVMA/dS/awBYW5/JsQi6ts3TSLCNnm8AWFtT3/NtSFjVjoTk4MvRtz7rBpzUZwNW+1cCSLC3zVPAozYBgw0AnNTnMrzqXm0zts9BwgSwqDVgTQMAJ3Vrjvf8jjY2qx0kbAPd3fmmAaBbOgR0ZATf0p1tSNhpjd/Vid7vnzRah3SgG6QtuQ54Vym1UUT+Tg5USm1AH535LmhvUkopEdlkf6GU6geesj4ezrW6xlb0RQj7ae4hUQn4t7fHHbavWf770Qtfcswx4PzawZsEL0L/+5wNZK952t69PfrK/qjD9nV019oFfhy4+Zy3QN0KXOwh4XMf+IStj4T9HvAr/rWtG3ggCV7wASR4wTeOgAASnOADSZgGvpEEGCDzmN6KOwrcFmC70EybpO0RoNc1vrTj8RiilOpFn/yMAvsl8M6gubm2ArgGfQR/QEScN1obTUAV8g8gqD4OuKDL0wAAAABJRU5ErkJggg==' /></td><td>บัญชีถูกลบ</td><td>"+threadlist[cnt-1].message_count+"</td></tr>";
							}
							else if(a.length==1){
								mergetxt+="<tr><td>"+cnt+"</td><td><img src='https://graph.facebook.com/"+a[0].id+"/picture'></img></td><td>"+a[0].name+"</td><td>"+threadlist[cnt-1].message_count+"</td></tr>";
							}else {
								var nameofgroup="";
								a.forEach(function(q){
									nameofgroup += q.name+","
								});
								nameofgroup = nameofgroup.substring(0, nameofgroup.length - 1);
								mergetxt+="<tr><td>"+cnt+"</td><td><img alt='' src='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAI3AAACNwBn+hfPAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAUQSURBVHic7ZptaFZlGMd/l5s5TDdLHUqWa2WUgi7d0KAXCcoiEbYgCBYEFkS0L0GU0ceCErL6UvjFiAWtl32xF5SklQRuvcwwFy3XMgxdkzmXUW5uXn247gcP63m2c9/n7DnCnj9cPA8818v//M997vs+1/2IqjKbMSdrAlmjJEDWBLJGSYCsCWSNkgBZE8gaJQGyJpA1ypMmEJGFQB1wK7AI+AE4rKonkuaeVGclUA+sB4aB74BuVf0rUWJVDTKgDHgBGAM0j+0HVoTmj9S51uXKV2PMcSgLzh9IajnQVYBU1M4CjQkuvhEYiVGnC1heTAE+i0EqZ+eAmoAa17vYuHX2FUUA4DEPUjk7AIhHDQG+CqjzRDEE+DmAmAJ1HjXWBtbo9b0er2VQRCqBm3xiIqj38N0UWGOViFT5BPjuA9ZjwzMEDR6+GwJrCMYxNnz3AWOe/lEM5r6ISB1wJzYqaoAfge+Bz9X2DzuB+7El0BejXt6ez/98YBz/Z/MjbLQtAN4ELhbw+xt4CruTtcDvnnXGgfkzPQke8SR1EKgAlgH9MWM+cYLVAH941DpSjFWgyVOAdS5ur2fc0wHLbtOMC+BItcYkdNT5N3tevAL/AquAK4CBGP6tQdcSKEAl0B6D1A7n/2mAAAo84+LfncavHagsmgARIZoL3J1R4G1gqfOLcwfzWZuLfwh7A5z8+wDQnOQaxBUIhohUYJNVPVAN9AGHgQFVvSAiy4BTgel7VfVmEZkDzANWY5ukEex1+Liqnk/C32sf4IhscyQ2YJuOq6fwX4dtncewZ9kXOeFagNcL1DgDdGP7iE5gr6pejF3BY7jXYkuazxB+0sV+4xmXs50u/n2PmINAbapzALAdv1fTnL3n4ncFCrDNxZ/wjDsHbE9FAGBLIHnFhnAF9pic9Izd5+qvSVB/SyIBgKoA9SfbGy7XVo+YYeAaYC7hj4867lVJBNiT8OIV2/dvcfkeBP6cxr8bWOv8X0qh/p4gAbBlp1DD08fGgVcjeZcAbwE/ARPO57y70zuAuc6vgrCu0GQbA+Z57wNEZCO2rIRiFHgHeEVV+yN5VwA3YG98C4DrgGPABWc9qno24n8H8DxwXwIum1S1K+8vU4yAFsJVPwM0RO7ks1gjdbrhn7M+bOl7OMLncS6NGF9rCXkEQp//QS69ATZgQz3JEP4Y1/IGHiGsH1FwHphKgLaAQv8Aq138c4Fk89kQcK/L+2hAfFuxBHjZxd5N4a5PqJ0Gql3+Q5ejAMPAVcBC4HjKF5+zdsdtc1oCpHk6vEtVh4EXgZUp5o2iSUQaVfVL4Is0EqYpQIf7fCDFnPmQy98xpVdMpClAj4gswtb4mUTugKUnjWRpCXDSDf/QAw0frHFNmKNpJJtKgA5sDY+D3E7vlmR0YqEcuDFSczr8hnWkCybLC1XdDewWkWrgLmebsbbU5OOxienypYxyVZ0QKXhK9ys2SbYCX2uh/T4xCKvqIPChM0RkMXZAWoPN9jXYEpgFDmA9h1NYg7QP6FTV03ETeN8xVR3CNiKHfGPThqrekzTHrP+XWEmArAlkjZIAKefbD7wGfIu9CqeNXux/gb+klTDx0VjBxCJXAhuB253dhrXAfDCC/fO0E/hAVbtTJckMCvC/QiJl2OnSUqwxuth9LsHaZsNY42MIa6kdA/qn2sSkwqtYAlyuKE2CWRPIGiUBsiaQNUoCZE0ga5QEyJpA1pj1AvwHhU/tLyyBgDAAAAAASUVORK5CYII=' /></td><td>"+nameofgroup+"</td><td>"+threadlist[cnt-1].message_count+"</td></tr>";
							}
							cnt++;
						});
						 $('#chat_table tr:eq(1)').remove();
						 $('#chat_table').append(mergetxt);
						 $("#right_load").hide;
						 $("#right_post").show();

					 }
					 
					 var threadexplore = function() {
						FB.api('/'+threadlist[cnt_thread].thread_id+'?fields=to',function(re) {
							if(!re.error){
								var tab_name_bf=[];
								var res =re.to.data;
								res.forEach(function (a){
									if(threadlist[cnt_thread].viewer_id!=a.id){
										tab_name_bf.push(a);
									}
								})
								tab_name.push(tab_name_bf);
								if(cnt_thread<threadlist.length-1){
									console.log("LOAD : "+(cnt_thread+1) + " / "+ threadlist.length);
									$("#loading_txt").html("โหลดแล้ว "+msg_fetch_cnt+" / "+thread.length+" คน");
									cnt_thread++;
									threadexplore();
								}else {
									mergetable();
								}
							})
							else {
								$("#loading_txt").html("เฟสบุ๊คปฏิเสธการใช้งานกรุณารอ 10 นาที");
							}
					 }
					 
                    var re = FB.api({
						method: 'fql.query',
						query: 'SELECT thread_id,viewer_id,recipients,message_count FROM thread WHERE folder_id = 0 ORDER BY message_count DESC'
					},function (re){
						if(!re.error){
						threadlist=re;
						threadexplore();
						$("#loading_txt").html("เฟสบุ๊คปฏิเสธการใช้งานกรุณารอ 10 นาที");
						}
					});
                } else{
					console.log("Not logged in");
					$("#app-display").hide();
					$("#login-display").show();
				}
            })
        };

    (function(d, s, id){
        var js, fjs = d.getElementsByTagName(s)[0];
        if (d.getElementById(id)) {return;}
        js = d.createElement(s); js.id = id;
        js.src = "//connect.facebook.net/th_TH/sdk.js";
        fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));
    var gotop = function(){
        $(function() {
		$('body,html').stop(true,true).animate({scrollTop: 0}, 1000);
        });
    }
    var postfacebook = function() {
		$("#right_post").hide();
		$("#right_load").show();
            var txt_postmsglength = 0;
            if(threadlist.length>=5){
                tthreadlistlength= 5;
            } else {
                threadlistlength= result_likes.length;
            }
            var i;
            var txt_postmsg = 'เพื่อนที่ฉันคุยด้วยมากที่สุด';
            for(i=0;i<threadlistlength;i++){
                txt_postmsg+='\nอันดับ '+(i+1)+ "ได้แก่ ";
				if(tab_name[i].length==0){
					txt_postmsg += "บัญชีถูกลบ"
				}else if(tab_name[i].length==1){
					txt_postmsg += tab_name[i][0].name;
				}else {
					var nameofgroup="";
								a.forEach(function(q){
									nameofgroup += q.name+","
								});
								nameofgroup = nameofgroup.substring(0, nameofgroup.length - 1);
					txt_postmsg += nameofgroup;
				}
				txt_postmsg += " -> "+threadlist[i].message_count+" แชท"
            }
            txt_postmsg+='\nสามารถดูเพิ่มเติมได้อีกถึง 50 อันดับ \nเข้ามาที่ pureapp.in.th/topchat #pureapp';
            FB.api('/me/feed', 'post', { message: txt_postmsg},function(res) {
				
					$("#right_load").hide();
					$("#right_ok").show();
        	});

    }
	var logintofacebook = function(){
		FB.login(function(){
			window.location.reload();
		},{scope: 'publish_actions,publish_stream,read_mailbox'})
	}

</script>
<nav class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="#">ใครคุยกับฉันมากสุด</a>
    </div>
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav navbar-right">
        <li><a href="https://www.facebook.com/appmadebypure">หน้าแรก</a></li>
        <li><a href="https://www.facebook.com/appmadebypure">แฟนเพจ</a></li>
        <li><a><div class="fb-like" data-href="https://purelink.koding.io/toplike_thismonth" data-layout="button_count" data-action="like" data-show-faces="true" data-share="true"></div></a></li>
      </ul>
    </div><!-- /.navbar-collapse -->
  </div><!-- /.container-fluid -->
</nav>
<div class="container" id="login-display" style="display: none;">
<div class="jumbotron">
  <h1>อีกขั้นเดียว!</h1>
  <p>เนื่องจากแอปพลิเคชันของเราต้องการเข้าถึงสิทธิในการใช้ข้อมูลส่วนตัวของคุณโดยทางเราขอให้คำมันสัญญาว่าทางเราจะไม่เก็บหรืออ่านข้อมูลส่วนตัวของผู้ใช้บริการเด็ดขาด โดยพวกเราจะใช้สิทธิต่างๆดังนี้ </p>
  <ul>
	<li>โพสข้อความของคุณ - ทุกแอปพลิเคชันของเราต้องการสิทธิในการโพสไปยังเฟสบุ๊คของคุณเพื่อให้สามารถใช้การปุ่มโพสไปยังเฟสบุ๊คได้</li>
	<li>เข้าถึงฟีดข่าวของคุณ - แอปคนที่ไลค์คุณมากสุดและคนที่คอมเม้นฉันมากสุดต้องการเข้าถึงฟีดข่าวของคุณเพื่อนับจำนวนคอมเม้นและไลค์</li>
	<!-- <li>เข้าถึงข้อความของคุณ - แอปใครไลค์ฉันมากสุดต้องการเข้าถึงข้อความของคุณเพื่อนับจำนวนแชทของคุณ</li> -->
 </ul> 
  <p>ขอแสดงความนับถือ - เพียว (ผู้สร้างแอป) </p>
	  <p><button onclick="logintofacebook()" class="btn btn-primary" id="postfacebtn"><span id="postface_txt">ลงชื่อเข้าใช้ด้วยเฟสบุ๊ค</span></button></p>
</div>
</div>




<div class="container" id="app-display" style="display: none;">

<div  id="right_post" style="display: none;">
        <button onclick="postfacebook()" class="btn btn-primary" id="postfacebtn"><span id="postface_txt">โพสบนเฟสบุ๊ค</span></button>
</div>
 <div  id="right_load" style="display: none;">
        <button class="btn btn-warning" ><span id=>กำลังโหลด</span></button>
</div>
 <div  id="right_ok" style="display: none;">
        <button class="btn btn-success" ><span id=>โพสเรียบร้อย</span></button>
</div>    
	
    <table class="table table-hover" id="chat_table">
        <thead><tr><th class="">#</th><th class="hidden-xs">รูป</th><th class="">ชื่อ</th><th class="">แชท</th></tr></thead>
		<tr><td colspan="4"><center><p id="loading_txt">โหลดแล้ว 0 / 50 คน</p><img alt="" src="data:image/gif;base64,R0lGODlhEAALAPQAAP///0Ve3uPn+dzh+O/x+0lh3kVe3mZ646Ov7oqa6szT9V1z4nqM56m0742c6s/V9WB14kdg3n2P5+zu+uLm+fb3/G2B5eXo+fX2/MnQ9LnC8tjd9/Lz+wAAAAAAAAAAACH+GkNyZWF0ZWQgd2l0aCBhamF4bG9hZC5pbmZvACH5BAALAAAAIf8LTkVUU0NBUEUyLjADAQAAACwAAAAAEAALAAAFLSAgjmRpnqSgCuLKAq5AEIM4zDVw03ve27ifDgfkEYe04kDIDC5zrtYKRa2WQgAh+QQACwABACwAAAAAEAALAAAFJGBhGAVgnqhpHIeRvsDawqns0qeN5+y967tYLyicBYE7EYkYAgAh+QQACwACACwAAAAAEAALAAAFNiAgjothLOOIJAkiGgxjpGKiKMkbz7SN6zIawJcDwIK9W/HISxGBzdHTuBNOmcJVCyoUlk7CEAAh+QQACwADACwAAAAAEAALAAAFNSAgjqQIRRFUAo3jNGIkSdHqPI8Tz3V55zuaDacDyIQ+YrBH+hWPzJFzOQQaeavWi7oqnVIhACH5BAALAAQALAAAAAAQAAsAAAUyICCOZGme1rJY5kRRk7hI0mJSVUXJtF3iOl7tltsBZsNfUegjAY3I5sgFY55KqdX1GgIAIfkEAAsABQAsAAAAABAACwAABTcgII5kaZ4kcV2EqLJipmnZhWGXaOOitm2aXQ4g7P2Ct2ER4AMul00kj5g0Al8tADY2y6C+4FIIACH5BAALAAYALAAAAAAQAAsAAAUvICCOZGme5ERRk6iy7qpyHCVStA3gNa/7txxwlwv2isSacYUc+l4tADQGQ1mvpBAAIfkEAAsABwAsAAAAABAACwAABS8gII5kaZ7kRFGTqLLuqnIcJVK0DeA1r/u3HHCXC/aKxJpxhRz6Xi0ANAZDWa+kEAA7AAAAAAAAAAAA" /></center></td><tr>
    </table>
</div>

<nav class="navbar navbar-default navbar-fixed-bottom" role="navigation" style="height: 50px;">
  <div class="container">
 <div class="">
    <ul class="nav navbar-nav">
     <li><a class="" href="#">พื้นที่ว่างสำหรับติดโฆษณา</a></li>
     </ul>
    </div>
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav navbar-right">
        <li><a href="https://www.facebook.com/appmadebypure">since 2014 : pure's app</a></li>
        <li><a href="javascript:gotop()">กลับไปบนสุด</a></li>
      </ul>
    </div> 
  </div>
</nav>
</body>
</html>
