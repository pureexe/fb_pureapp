<!-- GPLv3 @2014 - Pakkapon Phongthawee -->
<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <title>ฉันโพสบ่อยแค่ไหน : pure's app</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
    <script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
	<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
	<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-54361036-1', 'auto');
  ga('require', 'displayfeatures');
  ga('send', 'pageview');

</script>
    <style>
        body { padding-top: 70px;
                padding-bottom: 70px;
        }
    </style>
</head>
<body>
<div id="fb-root"></div>
<script src="http://fb.pureapp.in.th/js/Chart.min.js"></script>
<script src="http://fb.pureapp.in.th/js/base64binary.js"></script>
    <script>
	/// Utility Function
    $._GET = function(name, url) {
        if (!url) {
            url = window.location.href;
        }
        var results = new RegExp('[\\?&]' + name + '=([^&#]*)').exec(url);
        if (!results) { 
            return 0; 
        }
        return results[1] || 0;
    }
    function dateFromString(str) {
		var a = $.map(str.split(/[^0-9]/), function(s) { return parseInt(s, 10) });
		return new Date(a[0], a[1]-1 || 0, a[2] || 1, a[3] || 0, a[4] || 0, a[5] || 0, a[6] || 0);
    }
    $._DateDiff = function datediff(strDate1, strDat2) {
		if (!strDat2) {
			return (new Date().getTime()/1000-strDate1)/(60*60*24);
        } else {
			// nolonger
			return (strDate2-strDate1)/(60*60*24);
        }
    }         
	function postImageToFacebook( authToken, filename, mimeType, imageData, message ){
		var boundary = '----ThisIsTheBoundary1234567890';   
		// let's encode our image file, which is contained in the var
		var formData = '--' + boundary + '\r\n'
		formData += 'Content-Disposition: form-data; name="source"; filename="' + filename + '"\r\n';
		formData += 'Content-Type: ' + mimeType + '\r\n\r\n';
		for ( var i = 0; i < imageData.length; ++i ){
			formData += String.fromCharCode( imageData[ i ] & 0xff );
		}
		formData += '\r\n';
		formData += '--' + boundary + '\r\n';
		formData += 'Content-Disposition: form-data; name="message"\r\n\r\n';
		formData += message + '\r\n'
		formData += '--' + boundary + '--\r\n';
		var xhr = new XMLHttpRequest();
		xhr.open( 'POST', 'https://graph.facebook.com/me/photos?access_token=' + authToken, true );
		xhr.onload = xhr.onerror = function() {
				$("#right_load").hide();
				$("#right_ok").show();
			console.log(xhr.responseText);
		};
		xhr.setRequestHeader( "Content-Type", "multipart/form-data; boundary=" + boundary );
		try {
		if (typeof XMLHttpRequest.prototype.sendAsBinary == 'undefined') {
		XMLHttpRequest.prototype.sendAsBinary = function(text){
		var data = new ArrayBuffer(text.length);
		var ui8a = new Uint8Array(data, 0);
		for (var i = 0; i < text.length; i++) ui8a[i] = (text.charCodeAt(i) & 0xff);
			this.send(ui8a);
			}
			}
		} catch (e) {}
		xhr.sendAsBinary(formData);
	};
    // Global Variable
	var post_count = 0;
    var until="";
    var t_until="";
    var user_id="";
    var day = 7;
	var daylist = [];
	var round=0;
	var EOF;
	// Facebook Connector         
    window.fbAsyncInit = function() {
        FB.init({
            appId   : '351070565012663', // pure's app id
            xfbml      : true,
            version    : 'v2.0'
        });
		var getpostcallback = function(res){
			//console.log(JSON.stringify(res));
			res.forEach(function(p){
				if($._DateDiff(p.created_time)<=day){
					if(p.actor_id == user_id){
						if(Math.ceil($._DateDiff(p.created_time))>daylist.length){
							daylist.push(parseInt(p.like_info.like_count));
						}else{
							daylist[daylist.length-1]+=parseInt(p.like_info.like_count);
						}
						post_count++;
						//console.log($._DateDiff(p.created_time));
					}
				}else {
					EOF = true;
				}
			});
			$("#loading_txt").html("โหลดแล้ว "+post_count+" โพส");
			if(EOF==true){
				$("#loading_txt").html("สิ้นสุดแล้ว "+post_count+" โพส");
				//console.log(JSON.stringify(daylist));
				var ctx = document.getElementById("stats-display").getContext("2d");
				var canvas = document.getElementById("stats-display")
				canvas.width  = $("#app-display").width();
				canvas.height = ($(window).height()*1/2); 
				daylist.reverse();
				var chartdata = {
					labels: ["6 วันก่อน", "5 วันก่อน", "4 วันก่อน", "3 วันก่อน", "2 วันก่อน", "วันก่อน", "วันนี้"],
					datasets: [
					{
						label: "อัตราการกดไลค์",
						fillColor: "rgba(151,187,205,0.2)",
						strokeColor: "rgba(151,187,205,1)",
						pointColor: "rgba(151,187,205,1)",
						pointStrokeColor: "#fff",
						pointHighlightFill: "#fff",
						pointHighlightStroke: "rgba(151,187,205,1)",
						data: daylist
					}
				]};
				var myLineChart = new Chart(ctx).Line(chartdata);
				$("#right_load").hide();
				$("#right_post").show();
			} else {
					round++;
					FB.api({
						method: 'fql.query',
						query: "SELECT created_time,like_info.like_count,actor_id FROM stream WHERE source_id=me() LIMIT "+((50*round)+1)+","+(50*(round+1))+""
					},getpostcallback);
			}
		}
		var  appmain =function(){
			$("#app-display").show();
			$("#login-display").hide();
			$("#right_post").hide();
			$("#right_ok").hide();
			$("#right_err").hide();
			if($._GET("day")){
				day = $._GET("day");
			//console.log("GET day = "+day);
			}

			FB.api({
				method: 'fql.query',
				query: "SELECT created_time,like_info.like_count,actor_id FROM stream WHERE source_id=me() LIMIT 50"
			},getpostcallback);

		}
		FB.getLoginStatus(function(response) {
            if (response.status === 'connected') {
				user_id = response.authResponse.userID;
				FB.api("/me/permissions",function(perm){
					var canread = false;
					perm.data.forEach(function(a){
						if(a.permission == 'read_stream'){
							canread = true;
						}
					});
					if(canread){
						appmain();
					} else {
						$("#app-display").hide();
						$("#login-display").show();
					}
				});
				$("#app-display").hide();
				$("#login-display").show();
			} else{
			// console.log("Not logged in");
			$("#app-display").hide();
			$("#login-display").show();
			}
           })
        };

    (function(d, s, id){
        var js, fjs = d.getElementsByTagName(s)[0];
        if (d.getElementById(id)) {return;}
        js = d.createElement(s); js.id = id;
        js.src = "//connect.facebook.net/th_TH/sdk.js";
        fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));

    var postfacebook = function() {
		$("#right_post").hide();
		$("#right_load").show();
		var canvas = document.getElementById("stats-display");
		var data = canvas.toDataURL("image/png");
		var encodedPng = data.substring(data.indexOf(',') + 1, data.length);
		var decodedPng = Base64Binary.decode(encodedPng);
		var imagename="อัตราการกดไลค์ของโพสฉัน";
		var messagepost = "U+0E31 U+0E15 U+0E23 U+0E32 U+0E01 U+0E32 U+0E23 U+0E01 U+0E14 U+0E44 U+0E25 U+0E04 U+0E4C U+0E02 U+0E2D U+0E07 U+0E42 U+0E1E U+0E2A U+0E09 U+0E31 U+0E19";
		FB.getLoginStatus(function(response) {
		if (response.status === "connected") {	
			postImageToFacebook(response.authResponse.accessToken, imagename, "image/png", decodedPng, messagepost);
		} else if (response.status === "not_authorized") {
			FB.login(function(response) {
				postImageToFacebook(response.authResponse.accessToken, imagename, "image/png", decodedPng, messagepost);
			}, {scope: "publish_stream"});
		} else {
		FB.login(function(response)  { 
			postImageToFacebook(response.authResponse.accessToken, imagename, "image/png", decodedPng, messagepost);
		}, {scope: "publish_stream"});
	  }
	 });
    }
 var logintofacebook = function(){
  FB.login(function(){
   window.location.reload();
  },{scope: 'publish_actions,publish_stream,read_stream'}) // no longer ,read_mailbox
 }

</script>
<nav class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="http://www.pureapp.in.th">ใครไลค์ฉันมากสุด</a>
    </div>
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav navbar-right">
        <li><a href="http://www.pureapp.in.th">หน้าแรก</a></li>
        <li><a href="https://www.facebook.com/appmadebypure">แฟนเพจ</a></li>
        <li><a><div class="fb-like" data-href="http://www.pureapp.in.th/toplike" data-layout="button_count" data-action="like" data-show-faces="true" data-share="true"></div></a></li>
      </ul>
    </div><!-- /.navbar-collapse -->
  </div><!-- /.container-fluid -->
</nav>

<div class="container" id="login-display" style="display: none;">
  <h1>อีกขั้นเดียว!</h1>
  <p>เนื่องจากแอปพลิเคชันของเราต้องการเข้าถึงสิทธิในการใช้ข้อมูลส่วนตัวของคุณโดยทางเราขอให้คำมันสัญญาว่าทางเราจะไม่เก็บหรืออ่านข้อมูลส่วนตัวของผู้ใช้บริการเด็ดขาด โดยพวกเราจะใช้สิทธิต่างๆดังนี้ </p>
  <ul>
 <li>โพสข้อความของคุณ - ทุกแอปพลิเคชันของเราต้องการสิทธิในการโพสไปยังเฟสบุ๊คของคุณเพื่อให้สามารถใช้การปุ่มโพสไปยังเฟสบุ๊คได้</li>
 <li>เข้าถึงฟีดข่าวของคุณ - แอปใครคอมเม้นคุณมากที่สุดต้องการเข้าถึงฟีดข่าวของคุณเพื่อนับจำนวนคอมเม้น</li>
 <li>เข้าถึงข้อความของคุณ - แอปใครตุยกับฉันมากสุดต้องการเข้าถึงข้อความของคุณเพื่อนับจำนวนแชทของคุณ</li>
 </ul> 
  <p>ขอแสดงความนับถือ - เพียว (ผู้สร้างแอป) </p>
   <p><button onclick="logintofacebook()" class="btn btn-primary" id="postfacebtn"><span id="postface_txt">ลงชื่อเข้าใช้ด้วยเฟสบุ๊ค</span></button></p>
</div>

<div class="container" id="app-display" style="display: none;">
<div class='row' style='margin-bottom:10px;'>
<div  style="float:right;">
<div class="fb-like" data-href="https://www.pureapp.in.th/toplike" data-layout="button_count" data-action="like" data-show-faces="false" data-share="true"></div>
</div>
</div>
<div>
    <div class="btn-group">
        <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
            <span id="fetchtimedisplay">กำลังโหลด</span> <span class="caret"></span>
         </button>
        <ul class="dropdown-menu" role="menu">
            <li><a href="?day=7">7 วัน</a></li>
            <li class="divider"></li>
            <li><a href="?day=30">1 เดือน</a></li>
            <li class="divider"></li>
            <li><a href="?day=90">3 เดือน</a></li>
            <li class="divider"></li>
            <li><a href="?day=180">6 เดือน</a></li>
            <li class="divider"></li>
            <li><a href="?day=365">1 ปี</a></li>
        </ul>
    </div>

 <div style="float:right;" id="right_post" style="display: none;">
        <button onclick="postfacebook()" class="btn btn-primary" id="postfacebtn"><span id="postface_txt">โพสบนเฟสบุ๊ค</span></button>
</div>
 <div style="float:right;" id="right_load" style="display: none;">
        <button class="btn btn-warning" ><span>กำลังโหลด</span></button>
</div>
 <div style="float:right;" id="right_ok" style="display: none;">
        <button class="btn btn-success" ><span>โพสเรียบร้อย</span></button>
</div>
 <div style="float:right;" id="right_err" style="display: none;">
        <button class="btn btn-danger" ><span>ผิดพลาด</span><span id="err_msg"></span></button>
</div>        
</div>
	<center><div class="loading_dialog"><p id="loading_txt">โหลดแล้ว 0 โพส</p><img alt="" src="data:image/gif;base64,R0lGODlhEAALAPQAAP///0Ve3uPn+dzh+O/x+0lh3kVe3mZ646Ov7oqa6szT9V1z4nqM56m0742c6s/V9WB14kdg3n2P5+zu+uLm+fb3/G2B5eXo+fX2/MnQ9LnC8tjd9/Lz+wAAAAAAAAAAACH+GkNyZWF0ZWQgd2l0aCBhamF4bG9hZC5pbmZvACH5BAALAAAAIf8LTkVUU0NBUEUyLjADAQAAACwAAAAAEAALAAAFLSAgjmRpnqSgCuLKAq5AEIM4zDVw03ve27ifDgfkEYe04kDIDC5zrtYKRa2WQgAh+QQACwABACwAAAAAEAALAAAFJGBhGAVgnqhpHIeRvsDawqns0qeN5+y967tYLyicBYE7EYkYAgAh+QQACwACACwAAAAAEAALAAAFNiAgjothLOOIJAkiGgxjpGKiKMkbz7SN6zIawJcDwIK9W/HISxGBzdHTuBNOmcJVCyoUlk7CEAAh+QQACwADACwAAAAAEAALAAAFNSAgjqQIRRFUAo3jNGIkSdHqPI8Tz3V55zuaDacDyIQ+YrBH+hWPzJFzOQQaeavWi7oqnVIhACH5BAALAAQALAAAAAAQAAsAAAUyICCOZGme1rJY5kRRk7hI0mJSVUXJtF3iOl7tltsBZsNfUegjAY3I5sgFY55KqdX1GgIAIfkEAAsABQAsAAAAABAACwAABTcgII5kaZ4kcV2EqLJipmnZhWGXaOOitm2aXQ4g7P2Ct2ER4AMul00kj5g0Al8tADY2y6C+4FIIACH5BAALAAYALAAAAAAQAAsAAAUvICCOZGme5ERRk6iy7qpyHCVStA3gNa/7txxwlwv2isSacYUc+l4tADQGQ1mvpBAAIfkEAAsABwAsAAAAABAACwAABS8gII5kaZ7kRFGTqLLuqnIcJVK0DeA1r/u3HHCXC/aKxJpxhRz6Xi0ANAZDWa+kEAA7AAAAAAAAAAAA" /></center></div></center>
	<center><div class="canvas_dialog"><canvas id="stats-display"></canvas></div></center>
</div>
<div id="counterdiv"></div>

<nav class="navbar navbar-default navbar-fixed-bottom" role="navigation" style="height: 50px;">
  <div class="container">
 <div class="">
    <ul class="nav navbar-nav">
     <li><a class="" href="#">พื้นที่ว่างสำหรับติดโฆษณา</a></li>
     </ul>
    </div>
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav navbar-right">
        <li><a href="https://www.facebook.com/appmadebypure">since 2014 : pure's app</a></li>
        <li><a href="javascript:gotop()">กลับไปบนสุด</a></li>
				<li><script type="text/javascript" language="javascript1.1" src="http://tracker.stats.in.th/tracker.php?sid=60304"></script><noscript><a target="_blank" href="http://www.stats.in.th/">www.Stats.in.th</a></noscript></li>
      </ul>
    </div> 
  </div>
</nav>
</body>
</html>
